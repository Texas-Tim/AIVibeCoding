class e{constructor(){this.prefix="ultimate-frisbee-"}save(e,t){try{let s=JSON.stringify(t);return localStorage.setItem(this.prefix+e,s),!0}catch(e){return console.error("Failed to save to localStorage:",e),!1}}load(e,t=null){try{let s=localStorage.getItem(this.prefix+e);return s?JSON.parse(s):t}catch(e){return console.error("Failed to load from localStorage:",e),t}}remove(e){try{return localStorage.removeItem(this.prefix+e),!0}catch(e){return console.error("Failed to remove from localStorage:",e),!1}}clear(){try{return Object.keys(localStorage).forEach(e=>{e.startsWith(this.prefix)&&localStorage.removeItem(e)}),!0}catch(e){return console.error("Failed to clear localStorage:",e),!1}}}class t{constructor(){this.assets=new Map,this.loadPromises=new Map}async loadImage(e,t){if(this.assets.has(e))return console.log(`Asset ${e} already loaded`),this.assets.get(e);if(this.loadPromises.has(e))return this.loadPromises.get(e);console.log(`Loading image: ${e} from ${t}`);let s=new Promise((s,i)=>{let a=new Image;a.onload=()=>{console.log(`Successfully loaded image: ${e}`),this.assets.set(e,a),this.loadPromises.delete(e),s(a)},a.onerror=s=>{console.error(`Failed to load image: ${e} from ${t}`,s),this.loadPromises.delete(e),i(Error(`Failed to load image: ${t}`))},a.src=t});return this.loadPromises.set(e,s),s}async loadAudio(e,t){if(this.assets.has(e))return this.assets.get(e);if(this.loadPromises.has(e))return this.loadPromises.get(e);let s=new Promise((s,i)=>{let a=new Audio;a.oncanplaythrough=()=>{this.assets.set(e,a),this.loadPromises.delete(e),s(a)},a.onerror=()=>{this.loadPromises.delete(e),i(Error(`Failed to load audio: ${t}`))},a.src=t});return this.loadPromises.set(e,s),s}async loadAssets(e){console.log("Loading assets:",e);let t=e.map(e=>"image"===e.type?this.loadImage(e.name,e.path):"audio"===e.type?this.loadAudio(e.name,e.path):void 0),s=await Promise.all(t);return console.log("Assets loaded:",this.assets),s}getAsset(e){return this.assets.get(e)}hasAsset(e){return this.assets.has(e)}}class s{constructor(){this.state={currentScreen:"menu",score:{team1:0,team2:0},gameTime:180,players:[],frisbee:null,field:null,gameSettings:{difficulty:"medium",soundEnabled:!0,musicEnabled:!0}},this.listeners=new Map}setState(e,t){let s=this.state[e];this.state[e]=t,this.notifyListeners(e,t,s)}getState(e){return e?this.state[e]:this.state}updateState(e){Object.keys(e).forEach(t=>{this.setState(t,e[t])})}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{let s=this.listeners.get(e),i=s.indexOf(t);i>-1&&s.splice(i,1)}}notifyListeners(e,t,s){let i=this.listeners.get(e);i&&i.forEach(e=>{try{e(t,s)}catch(e){console.error("Error in state listener:",e)}})}reset(){this.setState("score",{team1:0,team2:0}),this.setState("gameTime",180),this.setState("currentScreen","menu")}}let i="#2a5d31",a="#1a4d21",r="#ffffff",o="#ff4444",l="#4444ff",n="#ffff44",h="#ffffff";class c{constructor(){this.gravity=0,this.friction=.95}updatePosition(e,t){e.x+=e.velocityX*t,e.y+=e.velocityY*t,e.velocityX*=this.friction,e.velocityY*=this.friction,this.checkBoundaries(e)}checkBoundaries(e){let t=e.size/2;e.x-t<0&&(e.x=t,e.velocityX=0),e.x+t>800&&(e.x=800-t,e.velocityX=0),e.y-t<0&&(e.y=t,e.velocityY=0),e.y+t>600&&(e.y=600-t,e.velocityY=0)}checkCollision(e,t){let s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)<(e.size+t.size)/2}resolveCollision(e,t){let s=e.x-t.x,i=e.y-t.y,a=Math.sqrt(s*s+i*i);if(0===a)return;let r=(e.size+t.size)/2-a,o=s/a*r*.5,l=i/a*r*.5;e.x+=o,e.y+=l,t.x-=o,t.y-=l}calculateThrowVector(e,t,s,i,a){let r=s-e,o=i-t,l=Math.sqrt(r*r+o*o);return 0===l?{x:0,y:0}:{x:r/l*a,y:o/l*a}}}class u{constructor(e){this.gameState=e,this.difficulty="medium",this.reactionTime=.5,this.lastDecision=0}update(e,t,s){this.lastDecision+=e,this.lastDecision<this.reactionTime||(t.filter(e=>e.isAI).forEach(i=>{this.updatePlayerAI(i,s,t,e)}),this.lastDecision=0)}updatePlayerAI(e,t,s,i){e.hasFrisbee?this.handleOffensiveAI(e,t,s):this.handleDefensiveAI(e,t,s)}handleOffensiveAI(e,t,s){let i=s.filter(t=>t.team===e.team&&t!==e),a=s.filter(t=>t.team!==e.team),r=null,o=-1;i.forEach(t=>{let s=this.evaluateThrowTarget(e,t,a);s>o&&(o=s,r=t)}),r&&o>.3&&this.throwToTarget(e,r,t)}handleDefensiveAI(e,t,s){let i=s.filter(t=>t.team!==e.team);if(t.isFlying)this.moveTowards(e,t.x,t.y);else{let t=this.findNearestOpponent(e,i);t&&this.markOpponent(e,t)}}evaluateThrowTarget(e,t,s){let i=Math.max(0,1-this.getDistance(e,t)/200),a=this.findNearestOpponent(t,s);return(i+(a?Math.max(0,this.getDistance(t,a)/50-1):1)+.5*(t.y<e.y))/3}throwToTarget(e,t,s){let i=Math.min(300,2*this.getDistance(e,t)),a=.3*t.velocityX,r=.3*t.velocityY;s.throw(e.x,e.y,t.x+a,t.y+r,i),e.hasFrisbee=!1}moveTowards(e,t,s){let i=t-e.x,a=s-e.y,r=Math.sqrt(i*i+a*a);r>5&&(e.velocityX=i/r*120,e.velocityY=a/r*120)}markOpponent(e,t){let s=t.x-e.x,i=t.y-e.y,a=Math.sqrt(s*s+i*i);a>40?this.moveTowards(e,t.x,t.y):a<20&&this.moveTowards(e,e.x-.1*s,e.y-.1*i)}findNearestOpponent(e,t){let s=null,i=1/0;return t.forEach(t=>{let a=this.getDistance(e,t);a<i&&(i=a,s=t)}),s}getDistance(e,t){let s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)}setDifficulty(e){switch(this.difficulty=e,e){case"easy":this.reactionTime=1;break;case"medium":this.reactionTime=.5;break;case"hard":this.reactionTime=.2}}}class m{constructor(e){this.assetLoader=e,this.sounds=new Map,this.music=null,this.soundEnabled=!0,this.musicEnabled=!0,this.masterVolume=1,this.soundVolume=.7,this.musicVolume=.3}async initialize(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),await this.loadBackgroundMusic()}catch(e){console.warn("Web Audio API not supported",e),this.audioContext=null}}async loadBackgroundMusic(){console.log("\uD83C\uDFB5 Checking browser permissions and loading music..."),console.log("Location:",window.location.href),console.log("Protocol:",window.location.protocol),"file:"===window.location.protocol&&(console.warn("⚠️ Running from file:// protocol - audio may not load"),console.log("\uD83D\uDCA1 Try running from http://localhost instead"));try{console.log("\uD83D\uDD0D Trying MP3 file..."),this.music=new Audio("assets/audio/background-music.mp3"),this.music.loop=!0,this.music.volume=this.masterVolume*this.musicVolume,this.music.addEventListener("error",e=>{console.error("❌ MP3 Error details:",{error:e.target.error,networkState:e.target.networkState,readyState:e.target.readyState,src:e.target.src})}),await new Promise((e,t)=>{let s=setTimeout(()=>{t(Error("MP3 load timeout"))},3e3);this.music.addEventListener("canplaythrough",()=>{clearTimeout(s),e()},{once:!0}),this.music.addEventListener("error",e=>{clearTimeout(s),t(e)},{once:!0}),this.music.load()}),console.log("✅ MP3 background music loaded successfully")}catch(e){console.warn("❌ MP3 failed, trying WAV:",e.message);try{console.log("\uD83D\uDD0D Trying WAV file..."),this.music=new Audio("assets/audio/background-music.wav"),this.music.loop=!0,this.music.volume=this.masterVolume*this.musicVolume,this.music.addEventListener("error",e=>{console.error("❌ WAV Error details:",{error:e.target.error,networkState:e.target.networkState,readyState:e.target.readyState,src:e.target.src})}),await new Promise((e,t)=>{let s=setTimeout(()=>{t(Error("WAV load timeout"))},3e3);this.music.addEventListener("canplaythrough",()=>{clearTimeout(s),e()},{once:!0}),this.music.addEventListener("error",e=>{clearTimeout(s),t(e)},{once:!0}),this.music.load()}),console.log("✅ WAV background music loaded successfully")}catch(e){console.error("❌ Both MP3 and WAV failed:",e.message),console.log("\uD83D\uDCA1 Suggestions:"),console.log("- Check if files exist in assets/audio/"),console.log("- Ensure running from http://localhost (not file://)"),console.log("- Check browser console for CORS errors"),console.log("- Verify audio file formats are supported"),this.music=null}}}createProgrammaticMusic(){this.audioContext&&(this.musicGainNode=this.audioContext.createGain(),this.musicGainNode.connect(this.audioContext.destination),this.musicGainNode.gain.setValueAtTime(this.masterVolume*this.musicVolume*.1,this.audioContext.currentTime),this.music={playing:!1,paused:!1,volume:this.masterVolume*this.musicVolume,play:()=>this.startProgrammaticMusic(),pause:()=>this.stopProgrammaticMusic(),currentTime:0,loop:!0},console.log("✅ Programmatic background music ready"))}startProgrammaticMusic(){this.audioContext&&!this.music.playing&&(this.music.playing=!0,this.playMelodyLoop())}stopProgrammaticMusic(){this.music.playing=!1,this.melodyTimeout&&clearTimeout(this.melodyTimeout)}playMelodyLoop(){if(!this.music.playing)return;let e=[262,294,330,349,392,440,494,523],t=[.5,.5,.5,.5,1,.5,.5,1],s=0,i=()=>{if(!this.music.playing)return;let a=e[s%e.length],r=.3*t[s%t.length],o=this.audioContext.createOscillator(),l=this.audioContext.createGain();o.connect(l),l.connect(this.musicGainNode),o.frequency.setValueAtTime(a,this.audioContext.currentTime),o.type="square",l.gain.setValueAtTime(.1,this.audioContext.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+r),o.start(this.audioContext.currentTime),o.stop(this.audioContext.currentTime+r),s++,this.melodyTimeout=setTimeout(i,1e3*r)};i()}playSound(e,t=1){if(this.soundEnabled&&this.audioContext)try{let s=this.masterVolume*this.soundVolume*t;switch(e){case"throw":this.playThrowSound(s);break;case"catch":this.playCatchSound(s);break;case"score":this.playScoreSound(s);break;case"whistle":this.playWhistleSound(s)}}catch(t){console.warn(`Error playing sound: ${e}`,t)}}playThrowSound(e){let t=this.audioContext.createOscillator(),s=this.audioContext.createGain();t.connect(s),s.connect(this.audioContext.destination),t.frequency.setValueAtTime(200,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(100,this.audioContext.currentTime+.2),s.gain.setValueAtTime(.3*e,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.2)}playCatchSound(e){let t=this.audioContext.createOscillator(),s=this.audioContext.createGain();t.connect(s),s.connect(this.audioContext.destination),t.frequency.setValueAtTime(400,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(600,this.audioContext.currentTime+.1),s.gain.setValueAtTime(.2*e,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.1)}playScoreSound(e){[262,330,392,523].forEach((t,s)=>{let i=this.audioContext.createOscillator(),a=this.audioContext.createGain();i.connect(a),a.connect(this.audioContext.destination),i.frequency.setValueAtTime(t,this.audioContext.currentTime+.1*s),a.gain.setValueAtTime(.2*e,this.audioContext.currentTime+.1*s),a.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1*s+.2),i.start(this.audioContext.currentTime+.1*s),i.stop(this.audioContext.currentTime+.1*s+.2)})}playWhistleSound(e){let t=this.audioContext.createOscillator(),s=this.audioContext.createGain();t.connect(s),s.connect(this.audioContext.destination),t.frequency.setValueAtTime(800,this.audioContext.currentTime),s.gain.setValueAtTime(.3*e,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.5)}playMusic(){if(!this.musicEnabled||!this.music)return void console.log("\uD83D\uDD07 Music disabled or not loaded");try{this.music.volume=this.masterVolume*this.musicVolume,console.log(`\u{1F3B5} Attempting to play music at volume: ${this.music.volume}`),this.music.play().then(()=>{console.log("✅ Background music started playing")}).catch(e=>{console.warn("❌ Failed to play background music:",e.message),"NotAllowedError"===e.name&&console.log("\uD83D\uDCA1 User interaction required - music will start after first click")})}catch(e){console.warn("Error playing background music",e)}}stopMusic(){if(this.music)try{this.music.pause(),this.music.currentTime=0}catch(e){console.warn("Error stopping background music",e)}}pauseMusic(){if(this.music)try{this.music.pause()}catch(e){console.warn("Error pausing background music",e)}}resumeMusic(){if(this.musicEnabled&&this.music)try{this.music.play().catch(e=>{console.warn("Failed to resume background music",e)})}catch(e){console.warn("Error resuming background music",e)}}setSoundEnabled(e){this.soundEnabled=e}setMusicEnabled(e){this.musicEnabled=e,e?this.playMusic():this.stopMusic()}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.music&&(this.music.volume=this.masterVolume*this.musicVolume)}setSoundVolume(e){this.soundVolume=Math.max(0,Math.min(1,e))}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),this.music&&(this.music.volume=this.masterVolume*this.musicVolume)}onThrow(){this.playSound("throw")}onCatch(){this.playSound("catch")}onScore(){this.playSound("score",1.2)}onGameStart(){this.playSound("whistle"),this.playMusic()}onGameEnd(){this.playSound("whistle"),this.stopMusic()}onGamePause(){this.pauseMusic()}onGameResume(){this.resumeMusic()}enableAudioContext(){this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume().then(()=>{console.log("✅ Audio context resumed")}),this.musicEnabled&&this.music&&this.music.paused&&this.playMusic()}}class d{constructor(e,t){this.canvas=e,this.ctx=e.getContext("2d"),this.assetLoader=t,this.canvas.width=800,this.canvas.height=600,this.ctx.imageSmoothingEnabled=!1}clear(){this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}drawField(){this.ctx.fillStyle=i,this.ctx.fillRect(0,0,800,600),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,100,600),this.ctx.fillRect(700,0,100,600),this.ctx.strokeStyle=r,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(100,0),this.ctx.lineTo(100,600),this.ctx.moveTo(700,0),this.ctx.lineTo(700,600),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(400,0),this.ctx.lineTo(400,600),this.ctx.stroke()}drawPlayer(e){let t=1===e.team?"player-team1":"player-team2",s=this.assetLoader.getAsset(t);s&&s.width>0?this.ctx.drawImage(s,e.x-8,e.y-8,16,16):(this.ctx.fillStyle=1===e.team?o:l,this.ctx.fillRect(e.x-8,e.y-8,16,16)),this.ctx.fillStyle=h,this.ctx.font="10px monospace",this.ctx.textAlign="center",this.ctx.fillText(e.number.toString(),e.x,e.y-8-5),e.hasFrisbee&&(this.ctx.strokeStyle=n,this.ctx.lineWidth=2,this.ctx.strokeRect(e.x-8-2,e.y-8-2,20,20))}drawFrisbee(e){if(console.log("Drawing frisbee - visible:",e.isVisible,"flying:",e.isFlying,"pos:",e.x,e.y),!e.isVisible)return;let t=this.assetLoader.getAsset("frisbee");t?this.ctx.drawImage(t,e.x-4,e.y-4,8,8):(this.ctx.fillStyle=n,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,4,0,2*Math.PI),this.ctx.fill()),e.isFlying&&(this.ctx.strokeStyle=n,this.ctx.lineWidth=1,this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e.startX,e.startY),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.setLineDash([]))}drawUI(e){let t=e.getState();this.ctx.fillStyle=h,this.ctx.font="20px monospace",this.ctx.textAlign="center",this.ctx.fillText(`${t.score.team1} - ${t.score.team2}`,400,30);let s=Math.floor(t.gameTime/60),i=Math.floor(t.gameTime%60),a=`${s}:${i.toString().padStart(2,"0")}`;this.ctx.fillText(a,400,55),"pause"===t.currentScreen?this.drawPauseOverlay():"gameOver"===t.currentScreen&&this.drawGameOverOverlay(t)}drawPauseOverlay(){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,800,600),this.ctx.fillStyle=h,this.ctx.font="40px monospace",this.ctx.textAlign="center",this.ctx.fillText("PAUSED",400,300),this.ctx.font="16px monospace",this.ctx.fillText("Press SPACE to resume",400,340)}drawGameOverOverlay(e){this.ctx.fillStyle="rgba(0, 0, 0, 0.8)",this.ctx.fillRect(0,0,800,600),this.ctx.fillStyle=h,this.ctx.font="40px monospace",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",400,260);let t=e.score.team1>e.score.team2?"Red Team":"Blue Team";this.ctx.font="24px monospace",this.ctx.fillText(`${t} Wins!`,400,300),this.ctx.font="20px monospace",this.ctx.fillText(`Final Score: ${e.score.team1} - ${e.score.team2}`,400,340),this.ctx.font="16px monospace",this.ctx.fillText("Press R to restart",400,380)}drawMenu(){this.clear(),this.ctx.fillStyle=h,this.ctx.font="48px monospace",this.ctx.textAlign="center",this.ctx.fillText("ULTIMATE",400,80),this.ctx.fillText("FRISBEE",400,130),this.ctx.font="16px monospace",this.ctx.fillStyle="#88ff88",this.ctx.fillText("Welcome to the ultimate arcade frisbee experience!",400,165),this.ctx.fillStyle=h,this.ctx.font="20px monospace",this.ctx.fillText("CONTROLS",400,200),this.ctx.font="14px monospace",this.ctx.textAlign="left";let e=240;this.ctx.fillText("MOVEMENT:",200,e),this.ctx.fillText("WASD or Arrow Keys",500,e),e+=25,this.ctx.fillText("THROW FRISBEE:",200,e),this.ctx.fillText("Click target location",500,e),e+=25,this.ctx.fillText("START GAME:",200,e),this.ctx.fillText("SPACE",500,e),e+=25,this.ctx.fillText("PAUSE/RESUME:",200,e),this.ctx.fillText("SPACE or ESC",500,e),e+=25,this.ctx.fillText("RESTART GAME:",200,e),this.ctx.fillText("R",500,e),e+=25,this.ctx.fillText("MAIN MENU:",200,e),this.ctx.fillText("M",500,e),e+=25,this.ctx.fillText("SELECT PLAYER:",200,e),this.ctx.fillText("1, 2, 3",500,e),e+=40,this.ctx.font="16px monospace",this.ctx.textAlign="center",this.ctx.fillText("OBJECTIVE: Score by reaching opponent's end zone with frisbee",400,e),e+=25,this.ctx.fillText("3 minutes • First to 7 points wins",400,e),e+=40,this.ctx.font="18px monospace",this.ctx.fillStyle="#ffff44",this.ctx.fillText("Press SPACE to start!",400,e)}}class y{constructor(e){this.canvas=e,this.keys=new Set,this.mouse={x:0,y:0,clicked:!1},this.callbacks=new Map,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",e=>this.handleKeyDown(e)),document.addEventListener("keyup",e=>this.handleKeyUp(e)),this.canvas.addEventListener("mousemove",e=>this.handleMouseMove(e)),this.canvas.addEventListener("mousedown",e=>this.handleMouseDown(e)),this.canvas.addEventListener("mouseup",e=>this.handleMouseUp(e)),this.canvas.addEventListener("contextmenu",e=>e.preventDefault())}handleKeyDown(e){this.keys.add(e.code),this.triggerCallback("keydown",e.code)}handleKeyUp(e){this.keys.delete(e.code),this.triggerCallback("keyup",e.code)}handleMouseMove(e){let t=this.canvas.getBoundingClientRect();this.mouse.x=e.clientX-t.left,this.mouse.y=e.clientY-t.top,this.triggerCallback("mousemove",this.mouse)}handleMouseDown(e){this.mouse.clicked=!0,this.triggerCallback("mousedown",this.mouse)}handleMouseUp(e){this.mouse.clicked=!1,this.triggerCallback("mouseup",this.mouse)}isKeyPressed(e){return this.keys.has(e)}getMovementVector(){let e=0,t=0;if((this.isKeyPressed("KeyA")||this.isKeyPressed("ArrowLeft"))&&(e-=1),(this.isKeyPressed("KeyD")||this.isKeyPressed("ArrowRight"))&&(e+=1),(this.isKeyPressed("KeyW")||this.isKeyPressed("ArrowUp"))&&(t-=1),(this.isKeyPressed("KeyS")||this.isKeyPressed("ArrowDown"))&&(t+=1),0!==e&&0!==t){let s=Math.sqrt(e*e+t*t);e/=s,t/=s}return{x:e,y:t}}isActionPressed(e){switch(e){case"pause":return this.isKeyPressed("Space")||this.isKeyPressed("Escape");case"restart":return this.isKeyPressed("KeyR");case"throw":return this.mouse.clicked;default:return!1}}getMousePosition(){return{x:this.mouse.x,y:this.mouse.y}}on(e,t){this.callbacks.has(e)||this.callbacks.set(e,[]),this.callbacks.get(e).push(t)}off(e,t){let s=this.callbacks.get(e);if(s){let e=s.indexOf(t);e>-1&&s.splice(e,1)}}triggerCallback(e,t){let s=this.callbacks.get(e);s&&s.forEach(e=>{try{e(t)}catch(e){console.error("Error in input callback:",e)}})}destroy(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("contextmenu",e=>e.preventDefault())}}class f{constructor(e,t,s,i,a,r){this.gameState=e,this.physics=t,this.ai=s,this.audio=i,this.renderer=a,this.input=r,this.players=[],this.frisbee=null,this.lastTime=0,this.gameLoop=null,this.initializeGame(),this.setupInputHandlers()}initializeGame(){this.createPlayers(),this.createFrisbee(),this.gameState.setState("currentScreen","menu"),this.startMenuLoop()}createPlayers(){this.players=[];for(let e=0;e<3;e++)this.players.push({id:`team1_${e}`,team:1,number:e+1,x:150+50*e,y:200+100*e,velocityX:0,velocityY:0,size:16,hasFrisbee:0===e,isAI:!1,isSelected:0===e});for(let e=0;e<3;e++)this.players.push({id:`team2_${e}`,team:2,number:e+1,x:650-50*e,y:200+100*e,velocityX:0,velocityY:0,size:16,hasFrisbee:!1,isAI:!0,isSelected:!1})}createFrisbee(){this.frisbee={x:this.players[0].x,y:this.players[0].y,velocityX:0,velocityY:0,size:8,isFlying:!1,isVisible:!1,startX:0,startY:0,owner:this.players[0]}}setupInputHandlers(){this.input.on("keydown",e=>{let t=this.gameState.getState("currentScreen");"Space"===e&&(this.audio.enableAudioContext(),"menu"===t?this.startGame():"game"===t?this.pauseGame():"pause"===t&&this.resumeGame()),"KeyR"===e&&this.restartGame(),"KeyM"===e&&this.goToMenu(),"Digit1"===e&&this.selectPlayer(1),"Digit2"===e&&this.selectPlayer(2),"Digit3"===e&&this.selectPlayer(3)}),this.input.on("mousedown",e=>{this.audio.enableAudioContext(),"game"===this.gameState.getState("currentScreen")&&this.handleThrow(e.x,e.y)})}startGame(){this.stopGameLoop(),this.gameState.setState("currentScreen","game"),this.gameState.setState("gameTime",180);try{this.audio.onGameStart()}catch(e){console.warn("Audio failed to start:",e)}this.startGameLoop()}pauseGame(){this.gameState.setState("currentScreen","pause"),this.audio.onGamePause(),this.stopGameLoop()}resumeGame(){this.gameState.setState("currentScreen","game"),this.audio.onGameResume(),this.startGameLoop()}restartGame(){this.gameState.reset(),this.initializeGame(),this.startGame()}goToMenu(){this.stopGameLoop(),this.gameState.reset(),this.initializeGame()}selectPlayer(e){let t=this.players.find(t=>1===t.team&&t.number===e);t&&(this.players.forEach(e=>e.isSelected=!1),t.isSelected=!0,console.log(`Selected player ${e}`))}startGameLoop(){this.stopGameLoop(),this.lastTime=performance.now(),this.gameLoop=requestAnimationFrame(e=>this.update(e))}startMenuLoop(){this.gameLoop||(this.gameLoop=requestAnimationFrame(()=>this.renderMenu()))}renderMenu(){this.render(),"menu"===this.gameState.getState("currentScreen")&&(this.gameLoop=requestAnimationFrame(()=>this.renderMenu()))}stopGameLoop(){this.gameLoop&&(cancelAnimationFrame(this.gameLoop),this.gameLoop=null)}update(e){let t=(e-this.lastTime)/1e3;this.lastTime=e,"game"===this.gameState.getState("currentScreen")&&(this.updateGame(t),this.updateTimer(t)),this.render(),"game"===this.gameState.getState("currentScreen")&&(this.gameLoop=requestAnimationFrame(e=>this.update(e)))}updateGame(e){this.updatePlayerMovement(e),this.updateFrisbee(e),this.checkCollisions(),this.checkScoring()}updatePlayerMovement(e){let t=this.players.find(e=>e.isSelected);if(t&&!t.isAI&&!t.hasFrisbee){let e=this.input.getMovementVector();t.velocityX=120*e.x,t.velocityY=120*e.y}this.players.forEach(e=>{if(!e.isAI&&!e.isSelected&&!e.hasFrisbee){let t=this.players.find(e=>1===e.team&&e.hasFrisbee),s=this.players.find(e=>2===e.team&&e.hasFrisbee);if(this.frisbee.isVisible&&this.frisbee.isFlying){let t=this.frisbee.x-e.x,s=this.frisbee.y-e.y,i=Math.sqrt(t*t+s*s);i>10&&(e.velocityX=t/i*84,e.velocityY=s/i*84)}else if(this.frisbee.isVisible&&!this.frisbee.isFlying){let t=this.frisbee.x-e.x,s=this.frisbee.y-e.y,i=Math.sqrt(t*t+s*s);i>10&&(e.velocityX=t/i*96,e.velocityY=s/i*96)}else if(s){let t=this.players.filter(t=>1===t.team&&t!==e),i=s.x,a=s.y;t.forEach(t=>{let s=e.x-t.x,r=e.y-t.y;60>Math.sqrt(s*s+r*r)&&(i+=.3*s,a+=.3*r)});let r=i-e.x,o=a-e.y,l=Math.sqrt(r*r+o*o);l>30?(e.velocityX=r/l*84,e.velocityY=o/l*84):(e.velocityX=(Math.random()-.5)*48,e.velocityY=(Math.random()-.5)*48)}else if(t){let s=this.players.filter(t=>1===t.team&&t!==e),i=this.players.filter(e=>2===e.team),a=750,r=300+(Math.random()-.5)*120;if(s.forEach(t=>{let s=e.x-t.x,i=e.y-t.y;70>Math.sqrt(s*s+i*i)&&(a+=.4*s,r+=.4*i)}),i.some(s=>25>this.distanceToLine(t.x,t.y,e.x,e.y,s.x,s.y))){let s=e.x-t.x,i=-(e.y-t.y),o=Math.sqrt(i*i+s*s);o>0&&(a+=i/o*60,r+=s/o*60)}let o=i.reduce((t,s)=>{let i=Math.sqrt((s.x-e.x)**2+(s.y-e.y)**2);return!t||i<t.distance?{player:s,distance:i}:t},null);if(o&&o.distance<40){let t=e.x-o.player.x,s=e.y-o.player.y;a+=.6*t,r+=.6*s}let l=a-e.x,n=r-e.y,h=Math.sqrt(l*l+n*n);h>15?(e.velocityX=l/h*72,e.velocityY=n/h*72):(e.velocityX=(Math.random()-.5)*36,e.velocityY=(Math.random()-.5)*36)}else e.velocityX=0,e.velocityY=0}}),this.players.forEach(t=>{if(t.isAI)if(t.hasFrisbee){if(t.aiThrowTimer||(t.aiThrowTimer=0),t.aiThrowTimer+=e,t.aiThrowTimer>1){let e=this.players.filter(e=>e.team===t.team&&e!==t),s=this.players.filter(e=>e.team!==t.team),i=e.reduce((e,i)=>{let a=Math.sqrt((i.x-t.x)**2+(i.y-t.y)**2);return s.some(e=>30>this.distanceToLine(t.x,t.y,i.x,i.y,e.x,e.y))?e:!e||a<e.distance?{player:i,distance:a}:e},null);if(i&&i.distance<200)this.throwFrisbee(t,i.player.x,i.player.y),t.aiThrowTimer=0;else if(t.aiThrowTimer>3){let s=2===t.team?50:750,i=300;e.some(e=>80>Math.sqrt((e.x-s)**2+(e.y-i)**2))?(this.throwFrisbee(t,s,i),t.aiThrowTimer=0):t.aiThrowTimer=2}}}else{let e=this.players.find(e=>1===e.team&&e.hasFrisbee),s=this.players.find(e=>2===e.team&&e.hasFrisbee);if(this.frisbee.isVisible&&this.frisbee.isFlying){let e=this.frisbee.x-t.x,s=this.frisbee.y-t.y,i=Math.sqrt(e*e+s*s);i>10?(t.velocityX=e/i*120,t.velocityY=s/i*120):(t.velocityX=0,t.velocityY=0)}else if(this.frisbee.isVisible&&!this.frisbee.isFlying){let e=this.frisbee.x-t.x,s=this.frisbee.y-t.y,i=Math.sqrt(e*e+s*s);i>5?(t.velocityX=e/i*120,t.velocityY=s/i*120):(t.velocityX=0,t.velocityY=0)}else if(e){let s=this.players.filter(e=>1===e.team),i=s[this.players.filter(e=>2===e.team).indexOf(t)%s.length];if(i&&i!==e){let s=(e.x+i.x)/2,a=(e.y+i.y)/2,r=s-t.x,o=a-t.y,l=Math.sqrt(r*r+o*o);l>20?(t.velocityX=r/l*96,t.velocityY=o/l*96):(t.velocityX=0,t.velocityY=0)}else if(i===e){let e=i.x-t.x,s=i.y-t.y,a=Math.sqrt(e*e+s*s);a>30?(t.velocityX=e/a*108,t.velocityY=s/a*108):(t.velocityX=0,t.velocityY=0)}}else if(s){let e=this.players.filter(e=>e.team!==t.team),i=this.players.filter(e=>e.team===t.team&&e!==t),a=50,r=300+(Math.random()-.5)*150;if(i.forEach(e=>{let s=t.x-e.x,i=t.y-e.y;80>Math.sqrt(s*s+i*i)&&(a+=.5*s,r+=.5*i)}),e.some(e=>25>this.distanceToLine(s.x,s.y,t.x,t.y,e.x,e.y))){let e=t.x-s.x,i=-(t.y-s.y),o=Math.sqrt(i*i+e*e);o>0&&(a+=i/o*50,r+=e/o*50)}e.forEach(e=>{let s=t.x-e.x,i=t.y-e.y;60>Math.sqrt(s*s+i*i)&&(a+=.4*s,r+=.4*i)});let o=a-t.x,l=r-t.y,n=Math.sqrt(o*o+l*l);n>15?(t.velocityX=o/n*84,t.velocityY=l/n*84):(t.velocityX=(Math.random()-.5)*36,t.velocityY=(Math.random()-.5)*36)}else t.velocityX=0,t.velocityY=0}t.hasFrisbee&&(t.throwTimer||(t.throwTimer=0),t.throwTimer+=e,t.throwTimer>5&&this.dropFrisbee(t)),this.physics.updatePosition(t,e)})}updateFrisbee(e){if(this.frisbee.isFlying){let t=Math.sqrt((this.frisbee.targetX-this.frisbee.startX)**2+(this.frisbee.targetY-this.frisbee.startY)**2);if(this.frisbee.flightProgress+=400*e/t,this.frisbee.flightProgress>=1)this.frisbee.x=this.frisbee.targetX,this.frisbee.y=this.frisbee.targetY,this.frisbee.isFlying=!1,this.frisbee.flightProgress=1;else{let e=this.frisbee.flightProgress;this.frisbee.x=this.frisbee.startX+(this.frisbee.targetX-this.frisbee.startX)*e,this.frisbee.y=this.frisbee.startY+(this.frisbee.targetY-this.frisbee.startY)*e}}}updateTimer(e){let t=Math.max(0,this.gameState.getState("gameTime")-e);this.gameState.setState("gameTime",t),t<=0&&this.endGame()}handleThrow(e,t){let s=this.players.find(e=>e.hasFrisbee);if(console.log("Throw attempt - thrower:",!!s,"flying:",this.frisbee.isFlying),!s)return;let i=this.players.find(i=>1===i.team&&i!==s&&16>Math.abs(i.x-e)&&16>Math.abs(i.y-t));i?this.throwFrisbee(s,i.x,i.y):this.throwFrisbee(s,e,t)}throwFrisbee(e,t,s){console.log("THROWING - from:",e.x,e.y,"to:",t,s),this.frisbee.x=e.x,this.frisbee.y=e.y,this.frisbee.targetX=t,this.frisbee.targetY=s,this.frisbee.startX=e.x,this.frisbee.startY=e.y,this.frisbee.flightProgress=0,this.frisbee.isFlying=!0,this.frisbee.isVisible=!0,this.frisbee.throwTime=performance.now(),this.frisbee.throwerTeam=e.team,e.hasFrisbee=!1,e.throwTimer=0,console.log("Frisbee state after throw:",{x:this.frisbee.x,y:this.frisbee.y,isFlying:this.frisbee.isFlying,isVisible:this.frisbee.isVisible,throwerTeam:this.frisbee.throwerTeam});try{this.audio.onThrow()}catch(e){}}dropFrisbee(e){this.frisbee.x=e.x,this.frisbee.y=e.y,this.frisbee.isFlying=!1,this.frisbee.isVisible=!0,this.frisbee.throwerTeam=e.team,e.hasFrisbee=!1,e.throwTimer=0,console.log("Player",e.team,"dropped frisbee due to 5-second rule")}checkCollisions(){!this.frisbee.isVisible||this.frisbee.isFlying&&performance.now()-this.frisbee.throwTime<100||this.players.forEach(e=>{let t=this.frisbee.throwerTeam===e.team,s=e.x-this.frisbee.x,i=e.y-this.frisbee.y;if(Math.sqrt(s*s+i*i)<(t?12.8:8)){if(!this.frisbee.isFlying&&this.frisbee.throwerTeam===e.team)return;this.catchFrisbee(e)}})}catchFrisbee(e){this.players.forEach(e=>e.hasFrisbee=!1),this.frisbee.isFlying=!1,this.frisbee.isVisible=!1,this.frisbee.x=e.x,this.frisbee.y=e.y,this.frisbee.velocityX=0,this.frisbee.velocityY=0,e.hasFrisbee=!0,this.audio.onCatch(),1===e.team&&(this.players.forEach(e=>e.isSelected=!1),e.isSelected=!0)}checkScoring(){let e=this.players.find(e=>e.hasFrisbee);!e||(1===e.team&&e.x>700||2===e.team&&e.x<100)&&this.score(e.team)}score(e){let t=this.gameState.getState("score");1===e?t.team1++:t.team2++,this.gameState.setState("score",t),this.audio.onScore(),this.resetPositions(),(t.team1>=7||t.team2>=7)&&this.endGame()}resetPositions(){this.createPlayers(),this.createFrisbee()}endGame(){this.gameState.setState("currentScreen","gameOver"),this.audio.onGameEnd(),this.stopGameLoop()}distanceToLine(e,t,s,i,a,r){let o,l,n=a-e,h=r-t,c=s-e,u=i-t,m=c*c+u*u;if(0===m)return Math.sqrt(n*n+h*h);let d=(n*c+h*u)/m;d<0?(o=e,l=t):d>1?(o=s,l=i):(o=e+d*c,l=t+d*u);let y=a-o,f=r-l;return Math.sqrt(y*y+f*f)}render(){"menu"===this.gameState.getState("currentScreen")?this.renderer.drawMenu():(this.renderer.clear(),this.renderer.drawField(),this.players.forEach((e,t)=>{this.renderer.drawPlayer(e)}),this.renderer.drawFrisbee(this.frisbee),this.renderer.drawUI(this.gameState))}}class x{constructor(){this.canvas=null,this.gameController=null,this.localStorage=new e}async initialize(){try{this.createCanvas();let e=new t,i=new s;this.loadSettings(i);let a=new c,r=new u(i),o=new m(e),l=new d(this.canvas,e),n=new y(this.canvas);this.loadSpritesSync(e),await o.initialize(),this.gameController=new f(i,a,r,o,l,n),console.log("Ultimate Frisbee Game initialized successfully!")}catch(e){console.error("Failed to initialize game:",e),this.showError("Failed to load game. Please refresh the page.")}}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=600,this.canvas.style.border="2px solid #333",this.canvas.style.background=i;let e=document.getElementById("app");e?e.appendChild(this.canvas):document.body.appendChild(this.canvas)}loadSettings(e){let t=this.localStorage.load("gameSettings",{difficulty:"medium",soundEnabled:!0,musicEnabled:!0});e.setState("gameSettings",t)}saveSettings(e){let t=e.getState("gameSettings");this.localStorage.save("gameSettings",t)}loadSpritesSync(e){console.log("Loading sprites asynchronously...");let t=new Image,s=new Image,i=new Image;t.onload=()=>{e.assets.set("player-team1",t),console.log("Red sprite loaded")},s.onload=()=>{e.assets.set("player-team2",s),console.log("Blue sprite loaded")},i.onload=()=>{e.assets.set("frisbee",i),console.log("Frisbee sprite loaded")},t.src="./player-red.png",s.src="./player-blue.png",i.src="./frisbee.png",console.log("Sprite loading initiated, game will continue...")}showError(e){let t=document.createElement("div");t.style.cssText=`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff4444;
            color: white;
            padding: 20px;
            border-radius: 5px;
            font-family: monospace;
            text-align: center;
            z-index: 1000;
        `,t.textContent=e,document.body.appendChild(t)}}document.addEventListener("DOMContentLoaded",async()=>{let e=new x;await e.initialize()}),document.addEventListener("visibilitychange",()=>{document.hidden&&console.log("Game paused due to tab visibility")}),window.addEventListener("resize",()=>{});
//# sourceMappingURL=UltimateFrisbeeArcadeGame.f55f99df.js.map
